<%= form_with model: expense, class: "space-y-6" do |form| %>
  <% if expense.errors.any? %>
    <div class="bg-rose-50 border border-rose-200 text-rose-700 px-4 py-3 rounded-lg">
      <h4 class="font-bold">Se encontraron <%= pluralize(expense.errors.count, "error") %>:</h4>
      <ul class="list-disc list-inside mt-2">
        <% expense.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Amount -->
    <div>
      <%= form.label :amount, "Monto", class: "block text-sm font-medium text-slate-700 mb-2" %>
      <%= form.number_field :amount, step: 0.01, placeholder: "95000.00",
          class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" %>
    </div>

    <!-- Currency -->
    <div>
      <%= form.label :currency, "Moneda", class: "block text-sm font-medium text-slate-700 mb-2" %>
      <%= form.select :currency,
          options_for_select(Expense.currencies.keys.map { |key| [key.upcase, key] }, expense.currency),
          {},
          { class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" } %>
    </div>

    <!-- Transaction Date -->
    <div>
      <%= form.label :transaction_date, "Fecha de Transacción", class: "block text-sm font-medium text-slate-700 mb-2" %>
      <%= form.date_field :transaction_date, value: expense.transaction_date&.strftime("%Y-%m-%d"),
          class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" %>
    </div>
  </div>

  <!-- Merchant Name -->
  <div>
    <%= form.label :merchant_name, "Comercio", class: "block text-sm font-medium text-slate-700 mb-2" %>
    <%= form.text_field :merchant_name, placeholder: "Nombre del comercio",
        class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" %>
  </div>

  <!-- Description -->
  <div>
    <%= form.label :description, "Descripción", class: "block text-sm font-medium text-slate-700 mb-2" %>
    <%= form.text_field :description, placeholder: "Descripción de la transacción",
        class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Category -->
    <div>
      <%= form.label :category_id, "Categoría", class: "block text-sm font-medium text-slate-700 mb-2" %>
      <%= form.select :category_id,
          options_from_collection_for_select(@categories, :id, :name, expense.category_id),
          { include_blank: "Seleccionar categoría" },
          { class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" } %>
    </div>

    <!-- Email Account -->
    <div>
      <%= form.label :email_account_id, "Cuenta de Email", class: "block text-sm font-medium text-slate-700 mb-2" %>
      <%= form.select :email_account_id,
          options_from_collection_for_select(@email_accounts, :id, :email, expense.email_account_id),
          { include_blank: "Entrada manual" },
          { class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" } %>
    </div>
  </div>

  <!-- Notes -->
  <div>
    <%= form.label :notes, "Notas", class: "block text-sm font-medium text-slate-700 mb-2" %>
    <%= form.text_area :notes, rows: 3, placeholder: "Notas adicionales (opcional)",
        class: "w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" %>
  </div>

  <!-- Submit Buttons -->
  <div class="flex items-center justify-end space-x-3 pt-6 border-t border-slate-200">
    <%= link_to "Cancelar", expense.persisted? ? expense : expenses_path,
        class: "bg-slate-200 hover:bg-slate-300 text-slate-700 px-6 py-2 rounded-lg font-medium" %>
    <%= form.submit expense.persisted? ? "Actualizar Gasto" : "Crear Gasto",
        class: "bg-teal-700 hover:bg-teal-800 text-white px-6 py-2 rounded-lg font-medium shadow-sm" %>
  </div>
<% end %>