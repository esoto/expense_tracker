<%# Quick Budget Setting Form - Used in modal or slide panel %>
<div class="p-6 bg-white rounded-xl" data-controller="budget-quick-set">
  <div class="mb-6">
    <h3 class="text-lg font-semibold text-slate-900">Establecer Presupuesto</h3>
    <p class="text-sm text-slate-600 mt-1">Define tu límite de gastos para mantener tus finanzas bajo control</p>
  </div>

  <%= form_with model: @budget, url: budgets_path, local: false, data: { turbo_frame: "_top" } do |form| %>
    <div class="space-y-4">
      <!-- Budget Name -->
      <div>
        <%= form.label :name, "Nombre del presupuesto", class: "block text-sm font-medium text-slate-700 mb-1" %>
        <%= form.text_field :name,
            class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500",
            placeholder: "Ej: Presupuesto Mensual" %>
      </div>

      <!-- Period Selection -->
      <div>
        <%= form.label :period, "Período", class: "block text-sm font-medium text-slate-700 mb-1" %>
        <div class="grid grid-cols-4 gap-2">
          <% Budget.periods.keys.each do |period| %>
            <label class="relative">
              <%= form.radio_button :period, period,
                  class: "peer sr-only",
                  data: { action: "change->budget-quick-set#updateSuggestedAmount" } %>
              <div class="px-3 py-2 text-center text-sm font-medium border-2 rounded-lg cursor-pointer transition-all
                          border-slate-200 hover:border-teal-300
                          peer-checked:border-teal-700 peer-checked:bg-teal-50 peer-checked:text-teal-700">
                <%= t("budgets.periods.#{period}") %>
              </div>
            </label>
          <% end %>
        </div>
      </div>

      <!-- Amount Input with Suggestion -->
      <div>
        <%= form.label :amount, "Monto del presupuesto", class: "block text-sm font-medium text-slate-700 mb-1" %>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500">₡</span>
          <%= form.number_field :amount,
              class: "w-full pl-8 pr-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500",
              placeholder: "0",
              step: 1000,
              min: 0,
              data: { "budget-quick-set-target": "amountInput" } %>
        </div>
        <% if @suggested_amount && @suggested_amount > 0 %>
          <p class="text-xs text-slate-600 mt-1">
            Sugerido basado en tu historial:
            <button type="button"
                    class="font-medium text-teal-700 hover:text-teal-800"
                    data-action="click->budget-quick-set#useSuggestedAmount"
                    data-suggested-amount="<%= @suggested_amount %>">
              ₡<%= number_with_delimiter(@suggested_amount.to_i) %>
            </button>
          </p>
        <% end %>
      </div>

      <!-- Category (Optional) -->
      <div>
        <%= form.label :category_id, "Categoría (opcional)", class: "block text-sm font-medium text-slate-700 mb-1" %>
        <%= form.select :category_id,
            options_for_select([["Todas las categorías", nil]] + Category.all.order(:name).map { |c| [c.name, c.id] }),
            {},
            class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
        <p class="text-xs text-slate-500 mt-1">
          Deja en blanco para un presupuesto general
        </p>
      </div>

      <!-- Alert Thresholds -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= form.label :warning_threshold, "Umbral de advertencia (%)", class: "block text-sm font-medium text-slate-700 mb-1" %>
          <%= form.number_field :warning_threshold,
              class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500",
              min: 0,
              max: 100,
              step: 5 %>
        </div>
        <div>
          <%= form.label :critical_threshold, "Umbral crítico (%)", class: "block text-sm font-medium text-slate-700 mb-1" %>
          <%= form.number_field :critical_threshold,
              class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500",
              min: 0,
              max: 100,
              step: 5 %>
        </div>
      </div>

      <!-- Visual Preview -->
      <div class="p-4 bg-slate-50 rounded-lg">
        <p class="text-sm font-medium text-slate-700 mb-2">Vista previa:</p>
        <div class="space-y-2">
          <div class="flex items-center justify-between text-xs">
            <span class="text-emerald-600">Bueno (0-70%)</span>
            <span class="text-amber-600">Advertencia (70-90%)</span>
            <span class="text-rose-600">Crítico (90%+)</span>
          </div>
          <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden flex">
            <div class="h-2 bg-emerald-600" style="width: 70%"></div>
            <div class="h-2 bg-amber-600" style="width: 20%"></div>
            <div class="h-2 bg-rose-600" style="width: 10%"></div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex justify-end space-x-3 pt-4 border-t">
        <button type="button"
                class="px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors"
                data-action="click->budget-quick-set#cancel">
          Cancelar
        </button>
        <%= form.submit "Crear Presupuesto",
            class: "px-4 py-2 text-sm font-medium text-white bg-teal-700 rounded-lg hover:bg-teal-800 transition-colors" %>
      </div>
    </div>
  <% end %>
</div>

<%# Translations (typically in config/locales/es.yml) %>
<%
  # Temporary inline translations
  def t(key)
    translations = {
      "budgets.periods.daily" => "Diario",
      "budgets.periods.weekly" => "Semanal",
      "budgets.periods.monthly" => "Mensual",
      "budgets.periods.yearly" => "Anual"
    }
    translations[key] || key
  end
%>