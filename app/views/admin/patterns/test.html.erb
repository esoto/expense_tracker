<div class="container mx-auto px-4 max-w-6xl">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-slate-900">Test Categorization Patterns</h1>
    <p class="text-slate-600 mt-1">Test how patterns match against sample expense data</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Test Input Form -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
      <h2 class="text-xl font-semibold text-slate-900 mb-4">Test Expense Data</h2>

      <%= form_with url: admin_patterns_test_pattern_path,
                    method: :post,
                    data: { turbo_frame: "test_results" } do |f| %>
        <div class="space-y-4">
          <div>
            <%= f.label :merchant_name, class: "block text-sm font-medium text-slate-700 mb-2" %>
            <%= f.text_field :merchant_name,
                value: @test_expense&.merchant_name,
                placeholder: "e.g., Starbucks",
                class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
          </div>

          <div>
            <%= f.label :description, class: "block text-sm font-medium text-slate-700 mb-2" %>
            <%= f.text_area :description,
                value: @test_expense&.description,
                placeholder: "e.g., Coffee and pastry",
                rows: 3,
                class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
          </div>

          <div>
            <%= f.label :amount, class: "block text-sm font-medium text-slate-700 mb-2" %>
            <%= f.number_field :amount,
                value: @test_expense&.amount,
                step: 0.01,
                placeholder: "0.00",
                class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
          </div>

          <div>
            <%= f.label :transaction_date, class: "block text-sm font-medium text-slate-700 mb-2" %>
            <%= f.datetime_local_field :transaction_date,
                value: @test_expense&.transaction_date&.strftime('%Y-%m-%dT%H:%M'),
                class: "w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
          </div>

          <%= f.submit "Test Patterns",
              class: "w-full px-4 py-2 bg-teal-700 hover:bg-teal-800 text-white rounded-lg text-sm font-medium" %>
        </div>
      <% end %>

      <!-- Quick Examples -->
      <div class="mt-6 pt-6 border-t border-slate-200">
        <h3 class="text-sm font-medium text-slate-700 mb-3">Quick Examples</h3>
        <div class="space-y-2">
          <button data-controller="pattern-test-example"
                  data-pattern-test-example-merchant-value="Uber"
                  data-pattern-test-example-description-value="Ride to airport"
                  data-pattern-test-example-amount-value="25.50"
                  data-action="click->pattern-test-example#fillForm"
                  class="w-full text-left px-3 py-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-sm">
            <span class="font-medium">Transportation:</span> Uber ride
          </button>
          <button data-controller="pattern-test-example"
                  data-pattern-test-example-merchant-value="Walmart"
                  data-pattern-test-example-description-value="Groceries"
                  data-pattern-test-example-amount-value="150.00"
                  data-action="click->pattern-test-example#fillForm"
                  class="w-full text-left px-3 py-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-sm">
            <span class="font-medium">Groceries:</span> Walmart shopping
          </button>
          <button data-controller="pattern-test-example"
                  data-pattern-test-example-merchant-value="Netflix"
                  data-pattern-test-example-description-value="Monthly subscription"
                  data-pattern-test-example-amount-value="15.99"
                  data-action="click->pattern-test-example#fillForm"
                  class="w-full text-left px-3 py-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-sm">
            <span class="font-medium">Entertainment:</span> Netflix subscription
          </button>
        </div>
      </div>
    </div>

    <!-- Test Results -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
      <h2 class="text-xl font-semibold text-slate-900 mb-4">Matching Patterns</h2>

      <%= turbo_frame_tag "test_results" do %>
        <div class="text-center py-12">
          <svg class="w-12 h-12 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          <p class="text-slate-500">Enter test data to see matching patterns</p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- All Active Patterns Reference -->
  <div class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
    <h2 class="text-xl font-semibold text-slate-900 mb-4">Active Patterns Reference</h2>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Pattern</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Category</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Confidence</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Success Rate</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-slate-200">
          <% @patterns.each do |pattern| %>
            <tr class="hover:bg-slate-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="px-2 py-1 text-xs rounded-full bg-slate-100 text-slate-700">
                  <%= pattern.pattern_type.humanize %>
                </span>
              </td>
              <td class="px-6 py-4 text-sm text-slate-900">
                <div class="max-w-xs truncate" title="<%= pattern.pattern_value %>">
                  <%= pattern.pattern_value %>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="px-2 py-1 text-xs rounded-full bg-teal-100 text-teal-700">
                  <%= pattern.category.name %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">
                <%= pattern.confidence_weight.round(1) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <div class="flex items-center">
                  <div class="w-12 bg-slate-200 rounded-full h-1.5 mr-2">
                    <div class="bg-<%= pattern.success_rate >= 0.7 ? 'emerald' : pattern.success_rate >= 0.4 ? 'amber' : 'rose' %>-500 h-1.5 rounded-full"
                         style="width: <%= (pattern.success_rate * 100).round %>%"></div>
                  </div>
                  <span class="text-slate-700 text-xs"><%= (pattern.success_rate * 100).round %>%</span>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>